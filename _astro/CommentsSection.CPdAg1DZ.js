import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r}from"./index.BJfUAbRs.js";import{s as l,a as w,g as u,b as L,S as n}from"./utils.BSVkwJxa.js";function J(){const[f,g]=r.useState(!1),[b,N]=r.useState(null),[h,E]=r.useState([]),[S,B]=r.useState(0),[T,k]=r.useState(""),[A,I]=r.useState(""),[d,v]=r.useState(!1),[y,F]=r.useState([]),[x,P]=r.useState(!1);r.useEffect(()=>{const t=new IntersectionObserver(([s])=>{s.isIntersecting&&(P(!0),t.disconnect())},{threshold:.1}),o=document.querySelector("#commentsSection");return o&&t.observe(o),()=>t.disconnect()},[]),r.useEffect(()=>{if(!x)return;async function t(){const{userAgent:o}=await u(),s=await fetch("https://api.ipify.org?format=json").then(a=>a.json()).then(a=>a.ip),c=await L(s);k(c),p(),m(),O()}return t(),()=>clearInterval(C)},[x]),r.useEffect(()=>{d&&D()},[d]);let C;function O(){C=setInterval(()=>{document.visibilityState==="visible"&&m()},3e4)}async function p(){try{const{userAgent:t}=await u(),o=await fetch("https://myapi.videyhost.my.id/api/?action=get_user_comment&token=AgungDeveloper",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userAgent:t})});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const s=await o.json();s.success&&s.has_commented?(g(!0),N(s.comment)):g(!1)}catch{l("Error loading user comment.","error")}}async function m(){if(document.visibilityState==="visible")try{const t=await fetch("https://myapi.videyhost.my.id/api/?action=get_comments&token=AgungDeveloper&limit=10");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const o=await t.json();if(o.success){const s=JSON.stringify(o.comments);s!==A&&(E(o.comments),B(o.total_comments),I(s))}else l("Failed to load comments.","error")}catch{l("Error loading comments. Please try again.","error")}}async function D(){try{const t=await fetch("https://myapi.videyhost.my.id/api/?action=get_comments&token=AgungDeveloper");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const o=await t.json();o.success?F(o.comments):l("Failed to load all comments.","error")}catch{l("Error loading all comments.","error")}}async function H(t){t.preventDefault();const o=t.target.commentName.value.trim(),s=t.target.commentMessage.value.trim();if(!o||!s){n.fire({title:"Error!",text:"Name and message are required.",icon:"error",customClass:{popup:"bg-[var(--bg-color)] text-[var(--text-color)]",confirmButton:"btn-neon"}});return}n.fire({title:"Confirm Your Comment",text:`Are you sure you want to submit this comment as ${o}?`,icon:"question",showCancelButton:!0,confirmButtonText:"Yes, submit",cancelButtonText:"Cancel",customClass:{popup:"bg-[var(--bg-color)] text-[var(--text-color)]",confirmButton:"btn-neon",cancelButton:"bg-gray-600 text-white px-4 py-2 rounded-lg"}}).then(async c=>{if(c.isConfirmed)try{const{userAgent:a}=await u(),i=await fetch("https://myapi.videyhost.my.id/api/?action=add_comment&token=AgungDeveloper",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:o,message:s,userAgent:a})});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const j=await i.json();j.success?(t.target.reset(),p(),m(),n.fire({title:"Success!",text:"Comment submitted successfully!",icon:"success",customClass:{popup:"bg-[var(--bg-color)] text-[var(--text-color)]",confirmButton:"btn-neon"}})):n.fire({title:"Error!",text:j.message||"Failed to submit comment.",icon:"error",customClass:{popup:"bg-[var(--bg-color)] text-[var(--text-color)]",confirmButton:"btn-neon"}})}catch{n.fire({title:"Error!",text:"Error submitting comment. Please try again.",icon:"error",customClass:{popup:"bg-[var(--bg-color)] text-[var(--text-color)]",confirmButton:"btn-neon"}})}})}async function q(){const t=document.getElementById("editCommentName").value.trim(),o=document.getElementById("editCommentMessage").value.trim();if(!t||!o){n.fire({title:"Error!",text:"Name and message are required.",icon:"error",customClass:{popup:"bg-[var(--bg-color)] text-[var(--text-color)]",confirmButton:"btn-neon"}});return}n.fire({title:"Confirm Update",text:`Are you sure you want to update your comment as ${t}?`,icon:"question",showCancelButton:!0,confirmButtonText:"Yes, update",cancelButtonText:"Cancel",customClass:{popup:"bg-[var(--bg-color)] text-[var(--text-color)]",confirmButton:"btn-neon",cancelButton:"bg-gray-600 text-white px-4 py-2 rounded-lg"}}).then(async s=>{if(s.isConfirmed)try{const{userAgent:c}=await u(),a=await fetch("https://myapi.videyhost.my.id/api/?action=edit_comment&token=AgungDeveloper",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,message:o,userAgent:c})});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const i=await a.json();i.success?(m(),n.fire({title:"Success!",text:"Comment updated successfully!",icon:"success",customClass:{popup:"bg-[var(--bg-color)] text-[var(--text-color)]",confirmButton:"btn-neon"}})):n.fire({title:"Error!",text:i.message||"Failed to update comment.",icon:"error",customClass:{popup:"bg-[var(--bg-color)] text-[var(--text-color)]",confirmButton:"btn-neon"}})}catch{n.fire({title:"Error!",text:"Error updating comment. Please try again.",icon:"error",customClass:{popup:"bg-[var(--bg-color)] text-[var(--text-color)]",confirmButton:"btn-neon"}})}})}async function _(){n.fire({title:"Confirm Deletion",text:"Are you sure you want to delete your comment?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete",cancelButtonText:"Cancel",customClass:{popup:"bg-[var(--bg-color)] text-[var(--text-color)]",confirmButton:"btn-neon",cancelButton:"bg-gray-600 text-white px-4 py-2 rounded-lg"}}).then(async t=>{if(t.isConfirmed)try{const{userAgent:o}=await u(),s=await fetch("https://myapi.videyhost.my.id/api/?action=delete_comment&token=AgungDeveloper",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userAgent:o})});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const c=await s.json();c.success?(p(),m(),n.fire({title:"Success!",text:"Comment deleted successfully!",icon:"success",customClass:{popup:"bg-[var(--bg-color)] text-[var(--text-color)]",confirmButton:"btn-neon"}})):n.fire({title:"Error!",text:c.message||"Failed to delete comment.",icon:"error",customClass:{popup:"bg-[var(--bg-color)] text-[var(--text-color)]",confirmButton:"btn-neon"}})}catch{n.fire({title:"Error!",text:"Error deleting comment. Please try again.",icon:"error",customClass:{popup:"bg-[var(--bg-color)] text-[var(--text-color)]",confirmButton:"btn-neon"}})}})}return x?e.jsxs("section",{id:"commentsSection",className:"py-12 sm:py-16 relative z-10 container bg-[var(--bg-color)]",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-center mb-8",children:"User Comments"}),e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{id:"commentFormContainer",className:"mb-8",children:[e.jsxs("form",{id:"commentForm",className:f?"hidden":"",onSubmit:H,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"commentName",className:"block text-sm font-medium text-[var(--text-color)]",children:"Name"}),e.jsx("input",{type:"text",id:"commentName",className:"mt-1 block w-full px-3 py-2 bg-[var(--bg-color)] text-[var(--text-color)] border-neon rounded-lg focus:outline-none focus:ring-2 focus:ring-neon-purple",maxLength:"50",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"commentMessage",className:"block text-sm font-medium text-[var(--text-color)]",children:"Comment"}),e.jsx("textarea",{id:"commentMessage",className:"mt-1 block w-full px-3 py-2 bg-[var(--bg-color)] text-[var(--text-color)] border-neon rounded-lg focus:outline-none focus:ring-2 focus:ring-neon-purple",rows:"4",maxLength:"500",required:!0})]}),e.jsx("button",{type:"submit",className:"btn-neon",children:"Submit Comment"})]}),e.jsxs("div",{id:"editCommentForm",className:f?"":"hidden",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"editCommentName",className:"block text-sm font-medium text-[var(--text-color)]",children:"Name"}),e.jsx("input",{type:"text",id:"editCommentName",className:"mt-1 block w-full px-3 py-2 bg-[var(--bg-color)] text-[var(--text-color)] border-neon rounded-lg focus:outline-none focus:ring-2 focus:ring-neon-purple",maxLength:"50",required:!0,defaultValue:b?.name||""})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"editCommentMessage",className:"block text-sm font-medium text-[var(--text-color)]",children:"Comment"}),e.jsx("textarea",{id:"editCommentMessage",className:"mt-1 block w-full px-3 py-2 bg-[var(--bg-color)] text-[var(--text-color)] border-neon rounded-lg focus:outline-none focus:ring-2 focus:ring-neon-purple",rows:"4",maxLength:"500",required:!0,defaultValue:b?.message||""})]}),e.jsx("button",{id:"submitEditComment",onClick:q,className:"btn-neon",children:"Update Comment"})]})]}),e.jsx("div",{id:"commentsList",className:"space-y-4",children:h.length===0?e.jsx("p",{className:"text-[var(--text-color)] text-center",children:"No comments yet. Be the first to comment!"}):h.map(t=>e.jsxs("div",{className:"bg-[var(--bg-color)] p-4 rounded-lg border-neon",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:t.name}),e.jsx("span",{className:"text-xs text-[var(--text-color)]",children:w(t.timestamp)})]}),e.jsx("p",{className:"text-[var(--text-color)]",children:t.message}),t.identifier===T&&e.jsxs("div",{className:"mt-2 flex space-x-2",children:[e.jsx("button",{className:"px-2 py-1 bg-blue-500 text-white rounded-lg hover:bg-blue-600",onClick:()=>{document.getElementById("editCommentForm").classList.remove("hidden"),document.getElementById("commentForm").classList.add("hidden"),window.scrollTo({top:document.getElementById("commentFormContainer").offsetTop,behavior:"smooth"})},children:"Edit"}),e.jsx("button",{className:"px-2 py-1 bg-red-500 text-white rounded-lg hover:bg-red-600",onClick:_,children:"Delete"})]})]},t.identifier))}),S>10&&e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{className:"text-[var(--heading-color)] hover:underline",onClick:()=>v(!0),children:"View All Comments"})})]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-[var(--bg-color)] rounded-lg p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold",children:"All Comments"}),e.jsx("button",{className:"text-[var(--text-color)] hover:text-neon-purple-light",onClick:()=>v(!1),children:"✕"})]}),e.jsx("div",{className:"space-y-4",children:y.length===0?e.jsx("p",{className:"text-[var(--text-color)] text-center",children:"No comments available."}):y.map(t=>e.jsxs("div",{className:"bg-[var(--bg-color)] p-4 rounded-lg border-neon",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-lg font-semibold",children:t.name}),e.jsx("span",{className:"text-xs text-[var(--text-color)]",children:w(t.timestamp)})]}),e.jsx("p",{className:"text-[var(--text-color)]",children:t.message})]},t.identifier))})]})})]}):e.jsx("div",{id:"commentsSection",className:"h-96"})}export{J as default};
