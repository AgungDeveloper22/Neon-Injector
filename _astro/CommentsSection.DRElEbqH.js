import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r}from"./index.BJfUAbRs.js";import{s as c,a as N,g as u,b as L,S as o}from"./sweetalert2.esm.all.CV6m8Zzw.js";const J=()=>{const[x,h]=r.useState(!1),[f,v]=r.useState(null),[y,B]=r.useState([]),[E,S]=r.useState(0),[T,k]=r.useState(""),[A,I]=r.useState(""),[d,b]=r.useState(!1),[w,F]=r.useState([]),[p,P]=r.useState(!1);r.useEffect(()=>{const t=new IntersectionObserver(([n])=>{n.isIntersecting&&(P(!0),t.disconnect())},{threshold:.1}),s=document.querySelector("#commentsSection");return s&&t.observe(s),()=>t.disconnect()},[]),r.useEffect(()=>{if(!p)return;async function t(){const{userAgent:s}=await u(),n=await fetch("https://api.ipify.org?format=json").then(i=>i.json()).then(i=>i.ip),a=await L(n);k(a),g(),l(),O()}return t(),()=>clearInterval(C)},[p]),r.useEffect(()=>{d&&D()},[d]);let C;function O(){C=setInterval(()=>{document.visibilityState==="visible"&&l()},3e4)}async function g(){try{const{userAgent:t}=await u(),s=await fetch("https://myapi.videyhost.my.id/api/?action=get_user_comment&token=AgungDeveloper",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userAgent:t})});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const n=await s.json();n.success&&n.has_commented?(h(!0),v(n.comment)):h(!1)}catch{c("Error loading user comment.","error")}}async function l(){if(document.visibilityState==="visible")try{const t=await fetch("https://myapi.videyhost.my.id/api/?action=get_comments&token=AgungDeveloper&limit=10");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const s=await t.json();if(s.success){const n=JSON.stringify(s.comments);n!==A&&(B(s.comments),S(s.total_comments),I(n))}else c("Failed to load comments.","error")}catch{c("Error loading comments. Please try again.","error")}}async function D(){try{const t=await fetch("https://myapi.videyhost.my.id/api/?action=get_comments&token=AgungDeveloper");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const s=await t.json();s.success?F(s.comments):c("Failed to load all comments.","error")}catch{c("Error loading all comments.","error")}}async function H(t){t.preventDefault();const s=t.target.commentName.value.trim(),n=t.target.commentMessage.value.trim();if(!s||!n){o.fire({title:"Error!",text:"Name and message are required.",icon:"error",customClass:{popup:"bg-gray-800 text-white",confirmButton:"bg-neon-purple text-white px-4 py-2 rounded-lg"}});return}o.fire({title:"Confirm Your Comment",text:`Are you sure you want to submit this comment as ${s}?`,icon:"question",showCancelButton:!0,confirmButtonText:"Yes, submit",cancelButtonText:"Cancel",customClass:{popup:"bg-gray-800 text-white",confirmButton:"bg-neon-purple text-white px-4 py-2 rounded-lg",cancelButton:"bg-gray-600 text-white px-4 py-2 rounded-lg"}}).then(async a=>{if(a.isConfirmed)try{const{userAgent:i}=await u(),m=await fetch("https://myapi.videyhost.my.id/api/?action=add_comment&token=AgungDeveloper",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:s,message:n,userAgent:i})});if(!m.ok)throw new Error(`HTTP error! status: ${m.status}`);const j=await m.json();j.success?(t.target.reset(),g(),l(),o.fire({title:"Success!",text:"Comment submitted successfully!",icon:"success",customClass:{popup:"bg-gray-800 text-white",confirmButton:"bg-neon-purple text-white px-4 py-2 rounded-lg"}})):o.fire({title:"Error!",text:j.message||"Failed to submit comment.",icon:"error",customClass:{popup:"bg-gray-800 text-white",confirmButton:"bg-neon-purple text-white px-4 py-2 rounded-lg"}})}catch{o.fire({title:"Error!",text:"Error submitting comment. Please try again.",icon:"error",customClass:{popup:"bg-gray-800 text-white",confirmButton:"bg-neon-purple text-white px-4 py-2 rounded-lg"}})}})}async function q(){const t=document.getElementById("editCommentName").value.trim(),s=document.getElementById("editCommentMessage").value.trim();if(!t||!s){o.fire({title:"Error!",text:"Name and message are required.",icon:"error",customClass:{popup:"bg-gray-800 text-white",confirmButton:"bg-neon-purple text-white px-4 py-2 rounded-lg"}});return}o.fire({title:"Confirm Update",text:`Are you sure you want to update your comment as ${t}?`,icon:"question",showCancelButton:!0,confirmButtonText:"Yes, update",cancelButtonText:"Cancel",customClass:{popup:"bg-gray-800 text-white",confirmButton:"bg-neon-purple text-white px-4 py-2 rounded-lg",cancelButton:"bg-gray-600 text-white px-4 py-2 rounded-lg"}}).then(async n=>{if(n.isConfirmed)try{const{userAgent:a}=await u(),i=await fetch("https://myapi.videyhost.my.id/api/?action=edit_comment&token=AgungDeveloper",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,message:s,userAgent:a})});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const m=await i.json();m.success?(l(),o.fire({title:"Success!",text:"Comment updated successfully!",icon:"success",customClass:{popup:"bg-gray-800 text-white",confirmButton:"bg-neon-purple text-white px-4 py-2 rounded-lg"}})):o.fire({title:"Error!",text:m.message||"Failed to update comment.",icon:"error",customClass:{popup:"bg-gray-800 text-white",confirmButton:"bg-neon-purple text-white px-4 py-2 rounded-lg"}})}catch{o.fire({title:"Error!",text:"Error updating comment. Please try again.",icon:"error",customClass:{popup:"bg-gray-800 text-white",confirmButton:"bg-neon-purple text-white px-4 py-2 rounded-lg"}})}})}async function _(){o.fire({title:"Confirm Deletion",text:"Are you sure you want to delete your comment?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete",cancelButtonText:"Cancel",customClass:{popup:"bg-gray-800 text-white",confirmButton:"bg-neon-purple text-white px-4 py-2 rounded-lg",cancelButton:"bg-gray-600 text-white px-4 py-2 rounded-lg"}}).then(async t=>{if(t.isConfirmed)try{const{userAgent:s}=await u(),n=await fetch("https://myapi.videyhost.my.id/api/?action=delete_comment&token=AgungDeveloper",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userAgent:s})});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const a=await n.json();a.success?(g(),l(),o.fire({title:"Success!",text:"Comment deleted successfully!",icon:"success",customClass:{popup:"bg-gray-800 text-white",confirmButton:"bg-neon-purple text-white px-4 py-2 rounded-lg"}})):o.fire({title:"Error!",text:a.message||"Failed to delete comment.",icon:"error",customClass:{popup:"bg-gray-800 text-white",confirmButton:"bg-neon-purple text-white px-4 py-2 rounded-lg"}})}catch{o.fire({title:"Error!",text:"Error deleting comment. Please try again.",icon:"error",customClass:{popup:"bg-gray-800 text-white",confirmButton:"bg-neon-purple text-white px-4 py-2 rounded-lg"}})}})}return p?e.jsxs("section",{id:"commentsSection",className:"py-12 sm:py-16 relative z-10 px-4 sm:px-6 bg-gray-900",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-center mb-8 text-neon-purple dark:text-neon-purple",children:"User Comments"}),e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{id:"commentFormContainer",className:"mb-8",children:[e.jsxs("form",{id:"commentForm",className:x?"hidden":"",onSubmit:H,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"commentName",className:"block text-sm font-medium text-gray-300",children:"Name"}),e.jsx("input",{type:"text",id:"commentName",className:"mt-1 block w-full px-3 py-2 bg-gray-800 text-white border border-neon-purple rounded-lg focus:outline-none focus:ring-2 focus:ring-neon-purple",maxLength:"50",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"commentMessage",className:"block text-sm font-medium text-gray-300",children:"Comment"}),e.jsx("textarea",{id:"commentMessage",className:"mt-1 block w-full px-3 py-2 bg-gray-800 text-white border border-neon-purple rounded-lg focus:outline-none focus:ring-2 focus:ring-neon-purple",rows:"4",maxLength:"500",required:!0})]}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-neon-purple text-white rounded-lg shadow-neon-glow hover:bg-neon-purple-light transition-colors",children:"Submit Comment"})]}),e.jsxs("div",{id:"editCommentForm",className:x?"":"hidden",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"editCommentName",className:"block text-sm font-medium text-gray-300",children:"Name"}),e.jsx("input",{type:"text",id:"editCommentName",className:"mt-1 block w-full px-3 py-2 bg-gray-800 text-white border border-neon-purple rounded-lg focus:outline-none focus:ring-2 focus:ring-neon-purple",maxLength:"50",required:!0,defaultValue:f?.name||""})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"editCommentMessage",className:"block text-sm font-medium text-gray-300",children:"Comment"}),e.jsx("textarea",{id:"editCommentMessage",className:"mt-1 block w-full px-3 py-2 bg-gray-800 text-white border border-neon-purple rounded-lg focus:outline-none focus:ring-2 focus:ring-neon-purple",rows:"4",maxLength:"500",required:!0,defaultValue:f?.message||""})]}),e.jsx("button",{id:"submitEditComment",onClick:q,className:"px-4 py-2 bg-neon-purple text-white rounded-lg shadow-neon-glow hover:bg-neon-purple-light transition-colors",children:"Update Comment"})]})]}),e.jsx("div",{id:"commentsList",className:"space-y-4",children:y.length===0?e.jsx("p",{className:"text-gray-300 text-center",children:"No comments yet. Be the first to comment!"}):y.map(t=>e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg border border-neon-purple-dark",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-neon-purple",children:t.name}),e.jsx("span",{className:"text-xs text-gray-400",children:N(t.timestamp)})]}),e.jsx("p",{className:"text-gray-300",children:t.message}),t.identifier===T&&e.jsxs("div",{className:"mt-2 flex space-x-2",children:[e.jsx("button",{className:"editCommentBtn px-2 py-1 bg-blue-500 text-white rounded-lg hover:bg-blue-600",onClick:()=>{document.getElementById("editCommentForm").classList.remove("hidden"),document.getElementById("commentForm").classList.add("hidden"),window.scrollTo({top:document.getElementById("commentFormContainer").offsetTop,behavior:"smooth"})},children:"Edit"}),e.jsx("button",{className:"deleteCommentBtn px-2 py-1 bg-red-500 text-white rounded-lg hover:bg-red-600",onClick:_,children:"Delete"})]})]},t.identifier))}),E>10&&e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{className:"text-neon-purple hover:underline",onClick:()=>b(!0),children:"View All Comments"})})]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-neon-purple",children:"All Comments"}),e.jsx("button",{className:"text-gray-300 hover:text-white",onClick:()=>b(!1),children:"✕"})]}),e.jsx("div",{className:"space-y-4",children:w.length===0?e.jsx("p",{className:"text-gray-300 text-center",children:"No comments available."}):w.map(t=>e.jsxs("div",{className:"bg-gray-900 p-4 rounded-lg border border-neon-purple-dark",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-lg font-semibold text-neon-purple",children:t.name}),e.jsx("span",{className:"text-xs text-gray-400",children:N(t.timestamp)})]}),e.jsx("p",{className:"text-gray-300",children:t.message})]},t.identifier))})]})})]}):e.jsx("div",{id:"commentsSection",className:"h-96"})};export{J as default};
