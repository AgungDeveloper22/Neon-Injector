import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as n}from"./index.BJfUAbRs.js";import{s as l,a as j,g as u,b as L,S as s}from"./utils.BSVkwJxa.js";function V(){const[p,g]=n.useState(!1),[b,w]=n.useState(null),[h,E]=n.useState([]),[S,B]=n.useState(0),[T,k]=n.useState(""),[A,q]=n.useState(""),[d,v]=n.useState(!1),[y,I]=n.useState([]),[x,F]=n.useState(!1);n.useEffect(()=>{const t=new IntersectionObserver(([r])=>{r.isIntersecting&&(F(!0),t.disconnect())},{threshold:.1}),o=document.querySelector("#commentsSection");return o&&t.observe(o),()=>t.disconnect()},[]),n.useEffect(()=>{if(!x)return;async function t(){const{userAgent:o}=await u(),r=await fetch("https://api.ipify.org?format=json",{cache:"force-cache"}).then(a=>a.json()).then(a=>a.ip),i=await L(r);k(i),f(),m(),P()}return t(),()=>clearInterval(C)},[x]),n.useEffect(()=>{d&&D()},[d]);let C;function P(){C=setInterval(()=>{document.visibilityState==="visible"&&m()},6e4)}async function f(){try{const{userAgent:t}=await u(),o=await fetch("https://myapi.videyhost.my.id/api/?action=get_user_comment&token=AgungDeveloper",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userAgent:t}),cache:"force-cache"});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const r=await o.json();r.success&&r.has_commented?(g(!0),w(r.comment)):g(!1)}catch{l("Error loading user comment.","error")}}async function m(){if(document.visibilityState==="visible")try{const t=await fetch("https://myapi.videyhost.my.id/api/?action=get_comments&token=AgungDeveloper&limit=10",{cache:"force-cache"});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const o=await t.json();if(o.success){const r=JSON.stringify(o.comments);r!==A&&(E(o.comments),B(o.total_comments),q(r))}else l("Failed to load comments.","error")}catch{l("Error loading comments. Please try again.","error")}}async function D(){try{const t=await fetch("https://myapi.videyhost.my.id/api/?action=get_comments&token=AgungDeveloper",{cache:"force-cache"});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const o=await t.json();o.success?I(o.comments):l("Failed to load all comments.","error")}catch{l("Error loading all comments.","error")}}async function M(t){t.preventDefault();const o=t.target.commentName.value.trim(),r=t.target.commentMessage.value.trim();if(!o||!r){s.fire({title:"Error!",text:"Name and message are required.",icon:"error",customClass:{popup:"bg-[var(--bg-color)] text-[var(--text-color)]",confirmButton:"btn-neon"}});return}s.fire({title:"Confirm Your Comment",text:`Are you sure you want to submit this comment as ${o}?`,icon:"question",showCancelButton:!0,confirmButtonText:"Yes, submit",cancelButtonText:"Cancel",customClass:{popup:"bg-[var(--bg-color)] text-[var(--text-color)]",confirmButton:"btn-neon",cancelButton:"bg-gray-600 text-white px-4 py-2 rounded-lg"}}).then(async i=>{if(i.isConfirmed)try{const{userAgent:a}=await u(),c=await fetch("https://myapi.videyhost.my.id/api/?action=add_comment&token=AgungDeveloper",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:o,message:r,userAgent:a})});if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);const N=await c.json();N.success?(t.target.reset(),f(),m(),s.fire({title:"Success!",text:"Comment submitted successfully!",icon:"success",customClass:{popup:"bg-[var(--bg-color)] text-[var(--text-color)]",confirmButton:"btn-neon"}})):s.fire({title:"Error!",text:N.message||"Failed to submit comment.",icon:"error",customClass:{popup:"bg-[var(--bg-color)] text-[var(--text-color)]",confirmButton:"btn-neon"}})}catch{s.fire({title:"Error!",text:"Error submitting comment. Please try again.",icon:"error",customClass:{popup:"bg-[var(--bg-color)] text-[var(--text-color)]",confirmButton:"btn-neon"}})}})}async function O(){const t=document.getElementById("editCommentName").value.trim(),o=document.getElementById("editCommentMessage").value.trim();if(!t||!o){s.fire({title:"Error!",text:"Name and message are required.",icon:"error",customClass:{popup:"bg-[var(--bg-color)] text-[var(--text-color)]",confirmButton:"btn-neon"}});return}s.fire({title:"Confirm Update",text:`Are you sure you want to update your comment as ${t}?`,icon:"question",showCancelButton:!0,confirmButtonText:"Yes, update",cancelButtonText:"Cancel",customClass:{popup:"bg-[var(--bg-color)] text-[var(--text-color)]",confirmButton:"btn-neon",cancelButton:"bg-gray-600 text-white px-4 py-2 rounded-lg"}}).then(async r=>{if(r.isConfirmed)try{const{userAgent:i}=await u(),a=await fetch("https://myapi.videyhost.my.id/api/?action=edit_comment&token=AgungDeveloper",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,message:o,userAgent:i})});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const c=await a.json();c.success?(m(),s.fire({title:"Success!",text:"Comment updated successfully!",icon:"success",customClass:{popup:"bg-[var(--bg-color)] text-[var(--text-color)]",confirmButton:"btn-neon"}})):s.fire({title:"Error!",text:c.message||"Failed to update comment.",icon:"error",customClass:{popup:"bg-[var(--bg-color)] text-[var(--text-color)]",confirmButton:"btn-neon"}})}catch{s.fire({title:"Error!",text:"Error updating comment. Please try again.",icon:"error",customClass:{popup:"bg-[var(--bg-color)] text-[var(--text-color)]",confirmButton:"btn-neon"}})}})}async function H(){s.fire({title:"Confirm Deletion",text:"Are you sure you want to delete your comment?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete",cancelButtonText:"Cancel",customClass:{popup:"bg-[var(--bg-color)] text-[var(--text-color)]",confirmButton:"btn-neon",cancelButton:"bg-gray-600 text-white px-4 py-2 rounded-lg"}}).then(async t=>{if(t.isConfirmed)try{const{userAgent:o}=await u(),r=await fetch("https://myapi.videyhost.my.id/api/?action=delete_comment&token=AgungDeveloper",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userAgent:o})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const i=await r.json();i.success?(f(),m(),s.fire({title:"Success!",text:"Comment deleted successfully!",icon:"success",customClass:{popup:"bg-[var(--bg-color)] text-[var(--text-color)]",confirmButton:"btn-neon"}})):s.fire({title:"Error!",text:i.message||"Failed to delete comment.",icon:"error",customClass:{popup:"bg-[var(--bg-color)] text-[var(--text-color)]",confirmButton:"btn-neon"}})}catch{s.fire({title:"Error!",text:"Error deleting comment. Please try again.",icon:"error",customClass:{popup:"bg-[var(--bg-color)] text-[var(--text-color)]",confirmButton:"btn-neon"}})}})}return x?e.jsxs("section",{id:"commentsSection",className:"py-12 sm:py-16 relative z-10 container bg-[var(--bg-color)]",role:"region","aria-label":"User comments section",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-center mb-8",children:"User Comments"}),e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{id:"commentFormContainer",className:"mb-8",children:[e.jsxs("form",{id:"commentForm",className:p?"hidden":"",onSubmit:M,"aria-label":"Submit a new comment",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"commentName",className:"block text-sm font-medium text-[var(--text-color)]",children:"Name"}),e.jsx("input",{type:"text",id:"commentName",className:"mt-1 block w-full px-3 py-2 bg-[var(--bg-color)] text-[var(--text-color)] border-neon rounded-lg focus:outline-none focus:ring-2 focus:ring-neon-purple",maxLength:"50",required:!0,"aria-required":"true","aria-describedby":"commentNameError"}),e.jsx("span",{id:"commentNameError",className:"hidden text-red-500 text-sm",children:"Name is required."})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"commentMessage",className:"block text-sm font-medium text-[var(--text-color)]",children:"Comment"}),e.jsx("textarea",{id:"commentMessage",className:"mt-1 block w-full px-3 py-2 bg-[var(--bg-color)] text-[var(--text-color)] border-neon rounded-lg focus:outline-none focus:ring-2 focus:ring-neon-purple",rows:"4",maxLength:"500",required:!0,"aria-required":"true","aria-describedby":"commentMessageError"}),e.jsx("span",{id:"commentMessageError",className:"hidden text-red-500 text-sm",children:"Comment is required."})]}),e.jsx("button",{type:"submit",className:"btn-neon","aria-label":"Submit comment",children:"Submit Comment"})]}),e.jsxs("div",{id:"editCommentForm",className:p?"":"hidden","aria-label":"Edit your comment",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"editCommentName",className:"block text-sm font-medium text-[var(--text-color)]",children:"Name"}),e.jsx("input",{type:"text",id:"editCommentName",className:"mt-1 block w-full px-3 py-2 bg-[var(--bg-color)] text-[var(--text-color)] border-neon rounded-lg focus:outline-none focus:ring-2 focus:ring-neon-purple",maxLength:"50",required:!0,"aria-required":"true",defaultValue:b?.name||"","aria-describedby":"editCommentNameError"}),e.jsx("span",{id:"editCommentNameError",className:"hidden text-red-500 text-sm",children:"Name is required."})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"editCommentMessage",className:"block text-sm font-medium text-[var(--text-color)]",children:"Comment"}),e.jsx("textarea",{id:"editCommentMessage",className:"mt-1 block w-full px-3 py-2 bg-[var(--bg-color)] text-[var(--text-color)] border-neon rounded-lg focus:outline-none focus:ring-2 focus:ring-neon-purple",rows:"4",maxLength:"500",required:!0,"aria-required":"true",defaultValue:b?.message||"","aria-describedby":"editCommentMessageError"}),e.jsx("span",{id:"editCommentMessageError",className:"hidden text-red-500 text-sm",children:"Comment is required."})]}),e.jsx("button",{id:"submitEditComment",onClick:O,className:"btn-neon","aria-label":"Update comment",children:"Update Comment"})]})]}),e.jsx("div",{id:"commentsList",className:"space-y-4",role:"list","aria-label":"List of user comments",children:h.length===0?e.jsx("p",{className:"text-[var(--text-color)] text-center",children:"No comments yet. Be the first to comment!"}):h.map(t=>e.jsxs("article",{className:"bg-[var(--bg-color)] p-4 rounded-lg border-neon",role:"listitem",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:t.name}),e.jsx("time",{className:"text-xs text-[var(--text-color)]",dateTime:t.timestamp,children:j(t.timestamp)})]}),e.jsx("p",{className:"text-[var(--text-color)]",children:t.message}),t.identifier===T&&e.jsxs("div",{className:"mt-2 flex space-x-2",children:[e.jsx("button",{className:"px-2 py-1 bg-blue-500 text-white rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500",onClick:()=>{document.getElementById("editCommentForm").classList.remove("hidden"),document.getElementById("commentForm").classList.add("hidden"),window.scrollTo({top:document.getElementById("commentFormContainer").offsetTop,behavior:"smooth"})},"aria-label":`Edit comment by ${t.name}`,children:"Edit"}),e.jsx("button",{className:"px-2 py-1 bg-red-500 text-white rounded-lg hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500",onClick:H,"aria-label":`Delete comment by ${t.name}`,children:"Delete"})]})]},t.identifier))}),S>10&&e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{className:"text-[var(--heading-color)] hover:underline focus:outline-none focus:ring-2 focus:ring-neon-purple",onClick:()=>v(!0),"aria-label":"View all comments",children:"View All Comments"})})]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",role:"dialog","aria-modal":"true","aria-label":"All comments modal",children:e.jsxs("div",{className:"bg-[var(--bg-color)] rounded-lg p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold",children:"All Comments"}),e.jsx("button",{className:"text-[var(--text-color)] hover:text-neon-purple-light focus:outline-none focus:ring-2 focus:ring-neon-purple",onClick:()=>v(!1),"aria-label":"Close comments modal",children:"âœ•"})]}),e.jsx("div",{className:"space-y-4",role:"list","aria-label":"List of all comments",children:y.length===0?e.jsx("p",{className:"text-[var(--text-color)] text-center",children:"No comments available."}):y.map(t=>e.jsxs("article",{className:"bg-[var(--bg-color)] p-4 rounded-lg border-neon",role:"listitem",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-lg font-semibold",children:t.name}),e.jsx("time",{className:"text-xs text-[var(--text-color)]",dateTime:t.timestamp,children:j(t.timestamp)})]}),e.jsx("p",{className:"text-[var(--text-color)]",children:t.message})]},t.identifier))})]})})]}):e.jsx("div",{id:"commentsSection",className:"h-96",role:"region","aria-label":"Comments section placeholder"})}export{V as default};
