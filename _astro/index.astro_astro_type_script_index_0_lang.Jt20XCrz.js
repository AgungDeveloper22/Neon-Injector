function n(s,a="error"){const e=document.getElementById("toast");e.textContent=s,e.className=`fixed bottom-4 right-4 p-4 rounded-lg shadow-lg text-white text-sm transition-opacity duration-300 opacity-100 ${a==="error"?"bg-red-500":"bg-green-500"}`,e.style.display="block",setTimeout(()=>{e.style.opacity="0",setTimeout(()=>{e.style.display="none"},300)},3e3)}async function m(){return{userAgent:navigator.userAgent}}function p(s,a,e=!1){a.innerHTML="";const r=Math.floor(s),t=s%1>=.5;for(let l=1;l<=5;l++){const o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttribute("class","w-4 h-4"),o.setAttribute("viewBox","0 0 24 24"),o.setAttribute("aria-hidden",e?"false":"true");const i=document.createElementNS("http://www.w3.org/2000/svg","path");if(i.setAttribute("d","M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"),l<=r)o.setAttribute("fill","#facc15");else if(l===r+1&&t){o.setAttribute("fill","url(#halfGrad)");const y=document.createElementNS("http://www.w3.org/2000/svg","defs"),c=document.createElementNS("http://www.w3.org/2000/svg","linearGradient");c.setAttribute("id","halfGrad"),c.setAttribute("x1","0%"),c.setAttribute("x2","100%");const u=document.createElementNS("http://www.w3.org/2000/svg","stop");u.setAttribute("offset","50%"),u.setAttribute("stop-color","#facc15");const f=document.createElementNS("http://www.w3.org/2000/svg","stop");f.setAttribute("offset","50%"),f.setAttribute("stop-color","#9ca3af"),c.appendChild(u),c.appendChild(f),y.appendChild(c),o.appendChild(y)}else o.setAttribute("fill","#9ca3af");o.appendChild(i),a.appendChild(o)}}async function w(){try{const s=await fetch("https://myapi.videyhost.my.id/api/?action=get_stats&token=AgungDeveloper");if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const a=await s.json();a.success?(document.getElementById("totalDownloads").textContent=a.total_downloads||0,document.getElementById("totalRatings").textContent=a.total_ratings?`${a.total_ratings} reviews`:"0 reviews",document.getElementById("ratingCountMeta").content=a.total_ratings||0,document.getElementById("ratingValueMeta").content=a.average_rating?a.average_rating.toFixed(1):"0.0",p(a.average_rating||0,document.getElementById("avgRatingStars"))):n("Failed to load statistics.","error")}catch{n("Error loading statistics. Please try again.","error")}}document.getElementById("downloadBtn").addEventListener("click",async()=>{try{const{userAgent:s}=await m(),e=await(await fetch("https://myapi.videyhost.my.id/api/?action=download&token=AgungDeveloper",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userAgent:s})})).json();e.success?(document.getElementById("totalDownloads").textContent=e.total_downloads,n("Download recorded successfully!","success")):e.message==="This device has already downloaded the app"?n("You have already downloaded the app.","error"):n(e.message||"Failed to record download.","error")}catch{n("Error processing download. Please try again.","error")}finally{window.location.href="/download"}});let g=0;const d=document.querySelectorAll(".starBtn");d.forEach((s,a)=>{s.addEventListener("click",async()=>{try{g=parseInt(s.dataset.rating);const{userAgent:e}=await m(),r=await fetch("https://myapi.videyhost.my.id/api/?action=rate&token=AgungDeveloper",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rating:g,userAgent:e})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const t=await r.json();t.success?(document.getElementById("totalRatings").textContent=`${t.total_ratings} reviews`,document.getElementById("ratingCountMeta").content=t.total_ratings,document.getElementById("ratingValueMeta").content=t.average_rating.toFixed(1),p(t.average_rating,document.getElementById("avgRatingStars")),d.forEach((l,o)=>{const i=l.querySelector("svg");o<a?(i.setAttribute("fill","#facc15"),i.classList.remove("text-gray-400")):(i.setAttribute("fill","none"),i.classList.add("text-gray-400"))}),n("Rating submitted successfully!","success")):n(t.message||"Failed to submit rating.","error")}catch{n("Error submitting rating. Please try again.","error")}}),s.addEventListener("mouseenter",()=>{d.forEach((e,r)=>{const t=e.querySelector("svg");r<=a?(t.setAttribute("fill","#facc15"),t.classList.remove("text-gray-400")):(t.setAttribute("fill","none"),t.classList.add("text-gray-400"))})}),s.addEventListener("mouseleave",()=>{d.forEach((e,r)=>{const t=e.querySelector("svg");r<g?(t.setAttribute("fill","#facc15"),t.classList.remove("text-gray-400")):(t.setAttribute("fill","none"),t.classList.add("text-gray-400"))})}),s.addEventListener("focus",()=>{d.forEach((e,r)=>{const t=e.querySelector("svg");r<=a?(t.setAttribute("fill","#facc15"),t.classList.remove("text-gray-400")):(t.setAttribute("fill","none"),t.classList.add("text-gray-400"))})}),s.addEventListener("blur",()=>{d.forEach((e,r)=>{const t=e.querySelector("svg");r<g?(t.setAttribute("fill","#facc15"),t.classList.remove("text-gray-400")):(t.setAttribute("fill","none"),t.classList.add("text-gray-400"))})})});w();
